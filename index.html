<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do — Vanilla JS</title>
  <meta name="description" content="A fast, accessible, single‑file to‑do app. Drag & drop. LocalStorage. Filters. Import/Export." />
  <link rel="icon" href="data:,">
  <style>
    :root {
      --bg: #0f172a;           /* slate-900 */
      --panel: #111827;        /* gray-900 */
      --panel-2: #0b1220;      /* deeper */
      --text: #e5e7eb;         /* gray-200 */
      --muted: #94a3b8;        /* slate-400 */
      --accent: #22d3ee;       /* cyan-400 */
      --accent-2: #06b6d4;     /* cyan-500 */
      --danger: #f87171;       /* red-400 */
      --success: #34d399;      /* emerald-400 */
      --warning: #fbbf24;      /* amber-400 */
      --border: #1f2937;       /* gray-800 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, #0ea5e9 0%, transparent 35%),
                  radial-gradient(900px 900px at -10% -20%, #22c55e 0%, transparent 30%),
                  var(--bg);
      color: var(--text);
    }
    header { max-width: 860px; margin: 32px auto 0; padding: 0 16px; }
    header h1 { font-size: clamp(28px, 4vw, 44px); margin: 0 0 6px; letter-spacing: 0.4px; }
    header p { margin: 0; color: var(--muted); }

    .app { max-width: 860px; margin: 24px auto; padding: 16px; }
    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }

    .row { display: grid; gap: 12px; grid-template-columns: 1fr auto auto; align-items: center; padding: 16px; border-bottom: 1px solid var(--border); }
    .row:last-child { border-bottom: 0; }

    .input-wrap { display: grid; grid-template-columns: 1fr 120px 120px; gap: 10px; }
    .input, select, .date { width: 100%; background: #0b1220; color: var(--text); border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; outline: none; transition: border .15s ease, box-shadow .15s ease; }
    .input:focus, select:focus, .date:focus { border-color: var(--accent); box-shadow: 0 0 0 3px #22d3ee33; }

    .btn { appearance: none; border: 1px solid var(--border); background: #0b1220; color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; transition: transform .05s ease, background .2s ease, border-color .2s ease, opacity .2s;
      display: inline-flex; align-items: center; gap: 8px; }
    .btn:hover { background: #0f172a; }
    .btn:active { transform: translateY(1px); }
    .btn.primary { background: linear-gradient(180deg, var(--accent), var(--accent-2)); color: #00222a; border: none; }
    .btn.ghost { background: transparent; border-color: var(--border); }
    .btn.danger { background: #1b0b0b; border-color: #3a0f0f; color: #fecaca; }

    /* Toolbar */
    .toolbar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .spacer { flex: 1; }
    .chip { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: #0b1220; color: var(--muted); cursor: pointer; }
    .chip.active { border-color: var(--accent); color: var(--text); }

    /* List */
    ul { list-style: none; margin: 0; padding: 0; }
    li.task { display: grid; grid-template-columns: 28px 1fr auto; gap: 10px; align-items: center; padding: 14px 16px; border-top: 1px solid var(--border); }
    li.task:first-child { border-top: none; }

    .drag { cursor: grab; user-select: none; opacity: .8; }
    .drag:active { cursor: grabbing; }

    .checkbox { width: 20px; height: 20px; border: 2px solid var(--muted); border-radius: 6px; display: inline-grid; place-content: center; cursor: pointer; transition: border-color .15s ease, background .15s ease; }
    .checkbox[aria-checked="true"] { background: var(--success); border-color: var(--success); }
    .checkbox svg { width: 14px; height: 14px; opacity: 0; transition: opacity .15s ease; }
    .checkbox[aria-checked="true"] svg { opacity: 1; }

    .title { display: block; font-size: 16px; }
    .muted { color: var(--muted); font-size: 12px; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); }
    .pill.low { color: #93c5fd; border-color: #1e3a8a; }
    .pill.med { color: #fbbf24; border-color: #7c2d12; }
    .pill.high { color: #fda4af; border-color: #7f1d1d; }

    .task:hover { background: #0c1322; }
    .task[aria-grabbed="true"] { outline: 2px dashed var(--accent); outline-offset: -6px; }

    .task-main { display: grid; gap: 6px; }
    .task-actions { display: flex; gap: 8px; }

    .task input.edit {
      width: 100%; background: transparent; border: 1px dashed var(--border); border-radius: 8px; padding: 6px 8px; color: var(--text);
    }

    .footer { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; padding: 16px; border-top: 1px solid var(--border); }
    .search { flex: 1; min-width: 180px; }

    .empty { text-align: center; padding: 30px 16px; color: var(--muted); }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; padding: 2px 6px; border: 1px solid var(--border); border-radius: 6px; background: #0b1220; color: var(--muted); }

    @media (max-width: 720px) {
      .input-wrap { grid-template-columns: 1fr 1fr; }
      .date { grid-column: 1 / -1; }
    }
  </style>
</head>
<body>
  <header>
    <h1>To‑Do</h1>
    <p>Fast, accessible, single‑file to‑do app. <span class="muted">Drag & drop, filters, local save, import/export.</span></p>
  </header>

  <main class="app">
    <section class="card" aria-label="Create a task">
      <div class="row">
        <div class="input-wrap" style="grid-column: 1 / -1;">
          <input id="newTitle" class="input" type="text" placeholder="What do you need to do? (e.g. Ship project README)" autocomplete="off" />
          <select id="newPriority" aria-label="Priority">
            <option value="low">Low</option>
            <option value="med" selected>Medium</option>
            <option value="high">High</option>
          </select>
          <input id="newDue" class="date" type="date" aria-label="Due date" />
        </div>
        <div class="toolbar" style="grid-column: 1 / -1;">
          <button id="addBtn" class="btn primary" title="Add task (Enter)">➕ Add</button>
          <span class="spacer"></span>
          <button data-filter="all" class="chip active">All</button>
          <button data-filter="active" class="chip">Active</button>
          <button data-filter="completed" class="chip">Completed</button>
          <span id="count" class="muted" aria-live="polite"></span>
        </div>
      </div>

      <ul id="list" aria-live="polite"></ul>

      <div class="footer">
        <input id="search" class="input search" type="search" placeholder="Search tasks (Ctrl/⌘K)" autocomplete="off" />
        <div style="display:flex; gap:8px;">
          <button id="clearCompleted" class="btn ghost">Clear completed</button>
          <button id="exportBtn" class="btn ghost">Export</button>
          <label class="btn ghost" for="importFile" title="Import previously exported JSON">Import<input id="importFile" type="file" accept="application/json" hidden></label>
          <button id="resetBtn" class="btn danger" title="Delete all tasks">Reset</button>
        </div>
      </div>
    </section>

    <p class="muted" style="text-align:center; margin-top:10px;">Tips: Press <span class="kbd">Enter</span> to add, <span class="kbd">E</span> to edit, <span class="kbd">⌫</span> to delete, drag handle to reorder.</p>
  </main>

  <template id="task-template">
    <li class="task" draggable="true">
      <div class="drag" title="Drag to reorder" aria-hidden="true">☰</div>
      <div role="checkbox" class="checkbox" tabindex="0" aria-checked="false" aria-label="Mark complete">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12" /></svg>
      </div>
      <div class="task-main">
        <span class="title"></span>
        <div class="muted meta"></div>
      </div>
      <div class="task-actions">
        <button class="btn ghost editBtn" title="Edit (E)">Edit</button>
        <button class="btn ghost delBtn" title="Delete (Del)">Delete</button>
      </div>
    </li>
  </template>

  <script>
  ;(() => {
    const els = {
      list: document.getElementById('list'),
      tmpl: document.getElementById('task-template'),
      newTitle: document.getElementById('newTitle'),
      newPriority: document.getElementById('newPriority'),
      newDue: document.getElementById('newDue'),
      addBtn: document.getElementById('addBtn'),
      chips: Array.from(document.querySelectorAll('[data-filter]')),
      count: document.getElementById('count'),
      search: document.getElementById('search'),
      clearCompleted: document.getElementById('clearCompleted'),
      exportBtn: document.getElementById('exportBtn'),
      importFile: document.getElementById('importFile'),
      resetBtn: document.getElementById('resetBtn'),
    };

    /*** State ***/
    let tasks = load();
    let filter = 'all';
    let dragId = null;

    function uid() { return Math.random().toString(36).slice(2, 10) + Date.now().toString(36); }

    function save() {
      localStorage.setItem('todo.v1', JSON.stringify(tasks));
    }
    function load() {
      try { return JSON.parse(localStorage.getItem('todo.v1')) || []; } catch { return []; }
    }

    function addTask(title, priority = 'med', due = '') {
      title = (title || '').trim();
      if (!title) return;
      const t = { id: uid(), title, completed: false, createdAt: Date.now(), priority, due, order: tasks.length ? Math.max(...tasks.map(x => x.order ?? 0)) + 1 : 1 };
      tasks.push(t); save(); render();
    }

    function toggleTask(id) {
      const t = tasks.find(t => t.id === id); if (!t) return; t.completed = !t.completed; save(); render();
    }

    function deleteTask(id) { tasks = tasks.filter(t => t.id !== id); save(); render(); }

    function updateTask(id, fields) { const t = tasks.find(t => t.id === id); if (!t) return; Object.assign(t, fields); save(); render(); }

    function clearCompleted() { tasks = tasks.filter(t => !t.completed); save(); render(); }

    function reorderTask(id, beforeId) {
      const moving = tasks.find(t => t.id === id); if (!moving) return;
      const list = tasks.filter(t => t.id !== id);
      if (!beforeId) list.push(moving); else {
        const idx = list.findIndex(t => t.id === beforeId);
        list.splice(idx, 0, moving);
      }
      tasks = list.map((t, i) => ({ ...t, order: i + 1 }));
      save(); render();
    }

    /*** Render ***/
    function formatDate(v) { if (!v) return ''; const d = new Date(v); return d.toLocaleDateString(); }

    function dueBadge(due) {
      if (!due) return '';
      const today = new Date(); today.setHours(0,0,0,0);
      const dd = new Date(due); dd.setHours(0,0,0,0);
      const diff = (dd - today) / 86400000;
      if (diff < 0) return `<span class="pill high" title="Overdue">Overdue • ${formatDate(due)}</span>`;
      if (diff === 0) return `<span class="pill med" title="Due today">Due today</span>`;
      if (diff <= 2) return `<span class="pill med" title="Due soon">Due soon • ${formatDate(due)}</span>`;
      return `<span class="pill low" title="Due">Due • ${formatDate(due)}</span>`;
    }

    function priorityBadge(p) {
      const map = { low: 'low', med: 'med', high: 'high' };
      const label = { low: 'Low', med: 'Medium', high: 'High' }[p] || 'Medium';
      return `<span class="pill ${map[p] || 'med'}">${label} priority</span>`;
    }

    function visible(t) {
      if (filter === 'active' && t.completed) return false;
      if (filter === 'completed' && !t.completed) return false;
      const q = els.search.value.trim().toLowerCase();
      if (q && !(`${t.title}`.toLowerCase().includes(q))) return false;
      return true;
    }

    function render() {
      tasks.sort((a,b) => (a.order ?? 0) - (b.order ?? 0));
      const frag = document.createDocumentFragment();
      const items = tasks.filter(visible);
      els.list.innerHTML = '';

      if (!items.length) {
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.innerHTML = 'No tasks here. Add one above!';
        els.list.appendChild(empty);
      } else {
        for (const t of items) frag.appendChild(taskItem(t));
        els.list.appendChild(frag);
      }

      const total = tasks.length; const active = tasks.filter(t => !t.completed).length; const comp = total - active;
      els.count.textContent = `${active} active • ${comp} completed • ${total} total`;

      els.chips.forEach(c => c.classList.toggle('active', c.dataset.filter === filter));
    }

    function taskItem(t) {
      const li = els.tmpl.content.firstElementChild.cloneNode(true);
      li.dataset.id = t.id;

      // drag handle is first child
      const drag = li.children[0];
      drag.setAttribute('draggable', 'true');

      // checkbox
      const cb = li.children[1];
      cb.setAttribute('aria-checked', String(!!t.completed));

      // main
      const main = li.querySelector('.task-main');
      const title = main.querySelector('.title');
      const meta = main.querySelector('.meta');

      title.textContent = t.title;
      title.style.textDecoration = t.completed ? 'line-through' : 'none';
      title.style.opacity = t.completed ? .6 : 1;

      const bits = [priorityBadge(t.priority), dueBadge(t.due)].filter(Boolean).join(' \u00a0 ');
      meta.innerHTML = `${bits}${bits ? ' • ' : ''}<span>Added ${new Date(t.createdAt).toLocaleString()}</span>`;

      // actions
      const editBtn = li.querySelector('.editBtn');
      const delBtn = li.querySelector('.delBtn');

      // events
      cb.addEventListener('click', () => toggleTask(t.id));
      cb.addEventListener('keydown', (e) => { if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); toggleTask(t.id); }});

      editBtn.addEventListener('click', () => beginEdit(li, t));
      delBtn.addEventListener('click', () => deleteTask(t.id));

      // drag events
      li.addEventListener('dragstart', (e) => { dragId = t.id; li.setAttribute('aria-grabbed','true'); e.dataTransfer.effectAllowed = 'move'; });
      li.addEventListener('dragend', () => { dragId = null; li.removeAttribute('aria-grabbed'); });
      li.addEventListener('dragover', (e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
      li.addEventListener('drop', (e) => { e.preventDefault(); const beforeId = li.dataset.id === dragId ? null : li.dataset.id; if (dragId) reorderTask(dragId, beforeId); });

      // keyboard shortcuts on item
      li.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'e') { e.preventDefault(); beginEdit(li, t); }
        if (e.key === 'Delete' || e.key === 'Backspace') { e.preventDefault(); deleteTask(t.id); }
      });

      return li;
    }

    function beginEdit(li, t) {
      const titleEl = li.querySelector('.title');
      const input = document.createElement('input');
      input.className = 'edit'; input.value = t.title; input.setAttribute('aria-label', 'Edit task');
      titleEl.replaceWith(input);
      input.focus(); input.select();
      const finish = (commit) => {
        if (commit) updateTask(t.id, { title: input.value.trim() || t.title }); else render();
      };
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') finish(true);
        if (e.key === 'Escape') finish(false);
      });
      input.addEventListener('blur', () => finish(true));
    }

    /*** Event wiring ***/
    els.addBtn.addEventListener('click', () => { addTask(els.newTitle.value, els.newPriority.value, els.newDue.value); els.newTitle.value=''; els.newTitle.focus(); });

    els.newTitle.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); els.addBtn.click(); } });

    els.chips.forEach(c => c.addEventListener('click', () => { filter = c.dataset.filter; render(); }));

    els.search.addEventListener('input', render);

    els.clearCompleted.addEventListener('click', clearCompleted);

    els.exportBtn.addEventListener('click', () => {
      const data = JSON.stringify(tasks, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), { href: url, download: 'todo-export.json' });
      a.click(); URL.revokeObjectURL(url);
    });

    els.importFile.addEventListener('change', async (e) => {
      const file = e.target.files[0]; if (!file) return;
      try {
        const text = await file.text();
        const data = JSON.parse(text);
        if (!Array.isArray(data)) throw new Error('Invalid file');
        // normalize & merge
        const seen = new Set(tasks.map(t => t.id));
        for (const t of data) {
          const n = {
            id: typeof t.id === 'string' && !seen.has(t.id) ? t.id : uid(),
            title: String(t.title || 'Untitled'),
            completed: !!t.completed,
            createdAt: Number(t.createdAt) || Date.now(),
            priority: ['low','med','high'].includes(t.priority) ? t.priority : 'med',
            due: t.due ? String(t.due) : '',
            order: Number(t.order) || (tasks.length + 1)
          };
          seen.add(n.id); tasks.push(n);
        }
        save(); render();
      } catch (err) { alert('Import failed: ' + err.message); }
      finally { e.target.value = ''; }
    });

    els.resetBtn.addEventListener('click', () => {
      if (confirm('Delete ALL tasks? This cannot be undone.')) { tasks = []; save(); render(); }
    });

    // Keyboard: Ctrl/Cmd+K focuses search
    window.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') { e.preventDefault(); els.search.focus(); }
    });

    // First render
    render();
  })();
  </script>
</body>
</html>
